# MyProxy: HTTP Load Balancer

## Ответы на вопросы

1. Самая интересная задача, которую я решал, была реализация функционала тренировки с разными весами и подходами в моём проекте. Нужно было спроектировать реляционную схему так, чтобы одно упражнение могло иметь несколько подходов с разными весами и повторениями, а ещё — обеспечить фильтрацию, сортировку и пагинацию для списка упражнений.

2. Мой самый крупный факап — на раннем этапе я запускал swagger-ui на удалённом сервере и прописал в конфиге localhost вместо публичного адреса. В результате одногруппники, с которыми мы делали проект, не могли тестировать api. Чтобы исправить ситуацию, я переписал конфиг, убедился, что все эндпоинтыы заработали по фактическому хосту. С тех пор в конфиге всё вынесено в переменные окружения.

3. Я ожидаю получить от буткемпа глубокие практические знания по развёртыванию и оркестрации сервисов в облаке, освоить ci/cd-процессы и контейнеризацию (docker, kubernetes), научиться выстраивать мониторинг и логирование микросервисов, а ещё — обменяться опытом с единомышленниками и получить навыки командной разработки по agile-методологиям. Хочется у быть готовым к реальным проектам в продакшене.


## Описание проекта

MyProxy — это HTTP-балансировщик нагрузки, реализованный на языке Go. Он принимает входящие HTTP-запросы и перенаправляет их на один из заранее заданных бэкенд-серверов. Балансировщик поддерживает алгоритм распределения запросов Round-Robin, обработку ошибок, логирование и периодические проверки состояния бэкендов (Health Checks).

## Основной функционал

### 1. HTTP-сервер
- Сервер принимает входящие запросы на порту, указанном в конфигурационном файле (по умолчанию 8080).
- Используется стандартный HTTP-пакет Go (`net/http`) для обработки запросов и переадресации (reverse proxy).

### 2. Распределение запросов
- Реализован алгоритм Round-Robin для равномерного распределения запросов между бэкендами.
- Балансировщик корректно обрабатывает ситуации, когда один или несколько бэкендов недоступны:
  - Исключает недоступные серверы из пула.
  - Перенаправляет запросы на работающие серверы.
  - Возвращает понятное сообщение об ошибке, если все серверы недоступны.

### 3. Параллелизм и конкурентность
- Обеспечена одновременная обработка нескольких запросов с использованием горутин.
- Используются мьютексы для предотвращения гонок данных.

### 4. Обработка ошибок
- Логируются ошибки при обращении к бэкендам.
- Выводятся понятные сообщения об ошибках в логах.

### 5. Логирование
- Логируются входящие запросы, ошибки и события (например, смена бэкенда при сбое сервера).
- Используется стандартный пакет `log`.

### 6. Конфигурация
- Конфигурация сервиса задается через файл `config/config.yaml`:
  - Порт для прослушивания.
  - Список бэкенд-серверов.
- Конфигурация независима от кода, что позволяет изменять настройки без перекомпиляции.

## Дополнительные возможности

### Здоровье бэкендов (Health Checks)
- Реализован механизм периодических проверок состояния каждого бэкенда.
- Недоступные серверы временно исключаются из пула, а при восстановлении работы возвращаются обратно.

### Graceful Shutdown
- Балансировщик корректно завершает работу при получении сигналов SIGINT или SIGTERM.
- Завершаются текущие запросы без потери данных.

## Архитектура проекта

Проект разделен на несколько модулей:
- **`internal/config`**: Работа с конфигурацией.
- **`internal/lb`**: Логика балансировки нагрузки.
- **`internal/proxy`**: Реализация прокси-сервера.
- **`internal/middleware`**: Middleware для логирования запросов.

## Запуск проекта

### Локальный запуск
1. Установите Go версии 1.23.1 или выше.
2. Склонируйте репозиторий:
   ```sh
   git clone https://github.com/shester1kov/myproxy.git
   cd myproxy```
3. Установите зависимости:
   ```sh
    go mod tidy
    ```
4. Запустите проект:
   ```sh
   go run main.go
   ```

### Запуск с помощью Docker
1. Соберите Docker-образ:
   ```sh
   docker build -t myproxy .
   ```
2. Запустите контейнер:
   ```sh
    docker run -d -p 8080:8080 myproxy
    ```

### Пример конфигурации
```yaml
port: 8080
backends:
  - http://localhost:5001
  - http://localhost:5002
  - http://localhost:5003
```